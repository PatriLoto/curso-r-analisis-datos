---
output:
  xaringan::moon_reader:
    lib_dir: libs
    css:  ["default", "default-fonts", "animate.css",  "hygge"]
    nature:
      highlightStyle: github
      highlightLines: true
      highlightSpans: true
      countIncrementalSlides: true
---
class: inverse, center
```{r , message=FALSE, warning=FALSE, include=FALSE} 
library(fontawesome)
library(emo)
```

# `r fa("r-project", fill = 'steelblue')`  para análisis de datos `r emo::ji("rocket")`<br> <br> 

## `r emo::ji("wrench")`Manipulación de datos `r emo::ji("computer")`<br> <br> <br> 

.large[Roxana N. Villafañe | LEMyP | <a href='http://twitter.com/data_datum'>`r fa("twitter", fill = 'steelblue')` @data_datum</a>] <br> 
.large[Florencia D'Andrea | INTA-CONICET | <a href="http://twitter.com/cantoflor_87"> `r fa("twitter", fill = 'steelblue')` @cantoflor_87</a><br>] 


<br><br><br><br><br> Slides disponibles en <https://bit.ly/curso-r-fca> `r emo::ji("sparkles")`
<br> Página web del curso en <https://curso-r-fca.netlify.com> `r emo::ji("star2")`


---

# Flujo de Ciencia de Datos `r emo::ji("pushpin")`


<img src="C://Users/Roxana/curso-r-analisis-datos/img/flujo-ciencia-datos.png" width="100%" align="center" />

---

class: inverse, center

<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="50%" align="center" />

# `Ordenar datos con tidyr`

---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

# Datos ordenados

Cuando hablamos de datos ordenados son referimos a:

### 1. Cada línea es una observación
### 2. Cada columna es una variable
### 3. Cada unidad de experimentación está en una tabla separada



.footnote[https://vita.had.co.nz/papers/tidy-data.pdf]

---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

# Ordenando datos desordenados


### 1. Los títulos de las columnas son números, no variables
### 2. Múltiples variables están guardadas en una columna. 
### 3. Las variables están guardadas en filas y columnas. 
### 4. Múltiples unidades de experimentación en la misma tabla.
### 5. Una única unidad de experimentación en diferentes tablas. 


.footnote[https://vita.had.co.nz/papers/tidy-data.pdf]

---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

# Funciones principales de tidyr

## pivot_longer()
_antes spread()_

--

## pivot_wider()
_antes gather()_

--
## unite()
## separate()

---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

### Cuando los nombres de las columnas no representan nombres de las variables, sino números

--

## `pivot_longer()`
--

```{r message=FALSE, eval=FALSE} 
pivot_longer(data, #dataset
             cols, #columnas para reordenar
             names_to = "xxx", #a partir de columnas colapsadas
             values_to = "yyy") #a partir de datos en celdas
```

.footnote[[*]
Mas información en https://tidyr.tidyverse.org/reference/pivot_longer.html
]
---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

```{r message=FALSE}
library(tidyr)
head(relig_income) #encabezado del dataset
```


---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

## `pivot_longer()`

```{r message=FALSE} 
relig_income %>%   #datos para ordenar 
  pivot_longer(-religion, #columnas para reordenar 
               names_to = "income", #columnas colapsadas
               values_to = "count") #el conteo de los casos
```



---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

### Multiples variables están en una sola columna
#### (esas variables pasarán a ser las nuevas columnas)

--

## `pivot_wider()`
--
```{r message=FALSE, eval=FALSE} 
pivot_wider(data, #dataset
            names_from = #de donde se crean las columnas
            values_from = #de donde obtengo los valores
```


.footnote[[*]
Mas información en https://tidyr.tidyverse.org/reference/pivot_wider.html
]
---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

```{r message=FALSE} 
fish_encounters
```

---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

```{r message=FALSE} 
fish_encounters %>% #ingreso de los datos 
  pivot_wider(names_from = station, 
              values_from = seen)
```

---

background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/dplyr-fondo.png)
background-size: cover
class: center, middle

# `pivot_longer()` 
# y 
# `pivot_wider()` 
# son operaciones inversas


---

background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/textura-fondo.png)
background-size: cover
class: center, middle, inverse


# `r emo::ji("wrench")` DEMO `r emo::ji("computer")`


---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

# `separate()`

* Lo utilizamos para separar columnas

```{r eval=FALSE, echo=FALSE}
install.packages("devtools")
devtools::install_github("rstudio/EDAWR")
storms<-EDAWR::storms
```

```{r }
storms<-EDAWR::storms
storms
```


.footnote[[*]
Mas información en https://github.com/rstudio/EDAWR]
---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

<br> <br>
```{r }
library(tidyr)
str2<- #creo un objeto de R
  storms %>% # a partir del dataset ´storms`
  separate(`date`, #la columna `date`
           c("year", "month", "day"), sep="-") # divido en 3
str2 #invoco el objeto creado
```

---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/tidyr-logo.png" width="10%" align="right" />

# unite()

* Lo utilizamos para unir columnas

```{r }
str3 <- str2 %>% #objeto creado anteriormente
  unite("date", #se crea la columna `date`
        year, month, day, sep="-") #a partir de otras tres 
str3
```

---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/dplyr-fondo.png)
background-size: cover
class: center, middle

# `unite()` 
# y 
# `separate()` 
# son operaciones inversas



---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

# Dataset: gapminder

```{r eval=FALSE}
install.packages(gapminder)
```

```{r }
library(gapminder)
```

---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

# Funciones útiles

## `head()`
```{r }
head(gapminder)
```


---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

#Funciones Útiles 

## `tail()`


```{r }
tail(gapminder)
```


---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

#Funciones Útiles

## `glimpse()`
```{r message=FALSE}
dplyr::glimpse(gapminder)
```

---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

#Funciones Útiles

## `slice()`

```{r gapminder, warning=FALSE}
dplyr::slice(gapminder, 5L)
```

---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" /> 

#Funciones Útiles

## `str()`

```{r }
str(gapminder)
```
---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

#Funciones Útiles

## `summary()`

```{r }
summary(gapminder)
```


---
class: inverse, center

<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="40%" align="center" />

# `Manipular datos con dplyr`

---
<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

# `select()`

* La función select() nos permite extraer columnas 

```{r message=FALSE}
library(dplyr)
gapminder %>% #datos para trabajar
  `select`(country, lifeExp, gdpPercap) %>% #elijo columnas
  head() #encabezado con los 6 primeros casos
```


.footnote[[*]
Mas información en https://dplyr.tidyverse.org/reference/select.html]

---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

# `filter()`

* La función filter() nos permite extraer filas mediante un criterio lógico

Para ello utilizamos los siguientes operadores: >, >=, <, =<, ==, !=

```{r }
gapminder %>% #datos para trabajar
  `filter`(lifeExp > 80) %>% #filas con expectativa mayor a 80 años
  head(3) #encabezado de 3 primeros casos
```


.footnote[[*]
Mas información en https://dplyr.tidyverse.org/reference/filter.html]

---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

# `filter()`


Podemos filtrar según múltiples condiciones:
- Se cumplen ambas condiciones 
```{r message=FALSE, warning=FALSE, eval=FALSE}
filter(condicion1`,` condicion2) 
```
- Se cumple la condición 1 solamente
```{r message=FALSE, warning=FALSE, eval=FALSE}
filter(condicion1, `!`condicion2) #niego la segunda condición
```
- Se cumplen la condición 1 y/ o la condición 2
```{r message=FALSE, warning=FALSE, eval=FALSE}
filter(condicion1 `|` condicion2)
```
- Se cumple una u otra condición, pero no ambas (disyunción exclusiva)
```{r message=FALSE, warning=FALSE, eval=FALSE}
filter(`xor`(condicion1, condicion2)) 
```



---

background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/textura-fondo.png)
background-size: cover
class: center, middle, inverse


# `r emo::ji("wrench")` DEMO `r emo::ji("computer")`

---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/dplyr-fondo.png)
background-size: cover
class: center, middle

# `select()`: extraer columnas
# `filter()`: extraer filas siguiendo una condición lógica

---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

# `mutate()`

* Permite crear nuevas variables a partir de una operación

```{r }
gapminder %>% 
  `mutate`(gdp = pop * gdpPercap) %>% #creo columna `gdp`
  head()
```


.footnote[[*] 
Más información en https://dplyr.tidyverse.org/reference/mutate.html]

---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

# `arrange()`

* Permite ordenar filas según una variable

```{r message=FALSE, warning=FALSE}
gapminder %>%
  `arrange`(year, country) %>% #ordeno según año y país
  head(4)
```

.footnote[[*] 
Más información en https://dplyr.tidyverse.org/reference/arrange.html]

---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/textura-fondo.png)
background-size: cover
class: center, middle, inverse


# `r emo::ji("wrench")` DEMO `r emo::ji("computer")`
---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/dplyr-fondo.png)
background-size: cover
class: center, middle

# `mutate()`: crea nuevas variables a partir de una operación
# `arrange()`: ordenar filas por variables



---


<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

#  `group_by()` y `summarize()`

```{r message=FALSE, warning=FALSE}
gdp_bycontinents <- gapminder %>%
    `group_by`(continent) %>% #agrupo por continentes
    `summarize`(mean_gdpPercap=mean(gdpPercap)) #resumo
gdp_bycontinents
```

.footnote[[*] 
Más información en https://dplyr.tidyverse.org/reference/summarise.html] 

---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

# `data %>% group_by(a)`

<img src="C://Users/Roxana/curso-r-analisis-datos/img/group_by.png" width="100%" align="center" />

.footnote[[*] 
Ejemplo tomado de https://swcarpentry.github.io/r-novice-gapminder-es/13-dplyr/] 


---

<img src="C://Users/Roxana/curso-r-analisis-datos/img/hex-dplyr.png" width="10%" align="right" />

# `data %>% group_by(a) %>% summarise(b)` 

<img src="C://Users/Roxana/curso-r-analisis-datos/img/summarise.png" width="100%" align="center" />



.footnote[[*] 
Ejemplo tomado de https://swcarpentry.github.io/r-novice-gapminder-es/13-dplyr/] 


---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/textura-fondo.png)
background-size: cover
class: center, middle, inverse


# `r emo::ji("wrench")` DEMO `r emo::ji("computer")`

---

background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/dplyr-fondo.png)
background-size: cover
class: center, middle

# `group_by()`: agrupar según un determinado criterio
# `summarize()`: cambiar la unidad de análisis



---

class: middle, center

## `select()`: extraer columnas
## `filter()`: extraer filas siguiendo una condición lógica
## `mutate()`: crea nuevas variables
## `arrange()`: ordenar filas por variables
## `group_by()`: agrupar según un determinado criterio
## `summarize()`: cambiar la unidad de análisis

---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/textura-fondo.png)
background-size: cover
class: center, middle, inverse


# `r emo::ji("wrench")` COFFEE BREAK `r emo::ji("computer")`


---

```{r message=FALSE, warning=FALSE}
devtools::session_info()
```

