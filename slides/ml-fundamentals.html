<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ml-fundamentals.utf8</title>
    <meta charset="utf-8" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/hygge.css" rel="stylesheet" />
    <link rel="stylesheet" href="animate.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: inverse, center


# &lt;svg style="height:0.8em;top:.04em;position:relative;fill:steelblue;" viewBox="0 0 581 512"&gt;&lt;path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/&gt;&lt;/svg&gt;  para an√°lisis de datos üöÄ&lt;br&gt; &lt;br&gt; 

## üéâModelizaci√≥n con tidymodels üíª 
### `Clasificaci√≥n`

.large[Roxana N. Villafa√±e | LEMyP | &lt;a href='http://twitter.com/data_datum'&gt;&lt;svg style="height:0.8em;top:.04em;position:relative;fill:steelblue;" viewBox="0 0 512 512"&gt;&lt;path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/&gt;&lt;/svg&gt; @data_datum&lt;/a&gt;] &lt;br&gt; 
.large[Florencia D'Andrea | INTA-CONICET | &lt;a href="http://twitter.com/cantoflor_87"&gt; &lt;svg style="height:0.8em;top:.04em;position:relative;fill:steelblue;" viewBox="0 0 512 512"&gt;&lt;path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/&gt;&lt;/svg&gt; @cantoflor_87&lt;/a&gt;&lt;br&gt;] 


&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt; Slides disponibles en &lt;https://bit.ly/curso-r-fca&gt; ‚ú®
&lt;br&gt; P√°gina web del curso en &lt;https://curso-r-fca.netlify.com&gt; üåü

---



&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

# Flujo de Ciencia de Datos üìå

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/flujo-ciencia-datos.png" width="100%" align="center" /&gt;



---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/fondo-madera.png)
background-size: cover
class: center, middle


# Es el proceso de desarrollo de una herramienta matem√°tica o modelo que genera una predicci√≥n precisa. 


---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;



# Ejemplos de modelos predictivos

&lt;br&gt;
#### Determinar si un tumor es maligno o benigno en una imagen m√©dica. 
#### Detectar actividad fraudulenta en transacciones de tarjeta de cr√©dito.
#### Identificar el c√≥digo zip de letras manuscritas en un sobre. 
#### Detectar patrones de acceso anormales en un website
#### Identificar t√≥picos (temas) en posteos de blogs. 



---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

# Partes del modelo predictivo


&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/partes-modelo.png" width="100%" align="center" /&gt;



---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

# Terminolog√≠a

* __Muestra, punto, observaci√≥n, instancia__ se refiere a una unidad de an√°lisis.
* __Set de entrenamiento__ son los datos utilizados para el modelado. 
* __Set de prueba__ son los datos utilizados para medir el desempe√±o del modelo, entre un conjunto de candidatos. 
* __Atributos, predictores, variables independientes o descriptores__ son los datos de entrada para la ecuaci√≥n de predicci√≥n.
* __Salida, variable dependiente, variable respuesta, clase, o "target"__ es la cantidad a ser predicha. 
* __Datos categ√≥ricos, tambi√©n conocidos como nominales o atributos__ toman valores espec√≠ficos que no tienen escala. Ejemplo: bueno/malo, rojo/azul, etc. 
* __Datos continuos__ son a base de escalas num√©ricas. El costo de un producto, la presi√≥n sangu√≠nea, n√∫mero de ba√±os, son datos continuos. Si bien el n√∫mero de ba√±os no puede ser fraccionaria, se considera como un dato continuo. 

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

# Modelizaci√≥n supervisada

### Clasificaci√≥n: la variable respuesta es una clase, es decir, una variable cualitativa 
En el dataset iris, el tipo de flor, iris setosa, versicolor, virginica.
### Regresi√≥n: la variable respuesta es un valor cuantitativo (un valor num√©rico a predecir). 
Predicci√≥n de precios de casas, seg√∫n variables como el barrio en el que pertenecen, n√∫mero de cuartos, si es de m√°s de un piso, etc. 


---
class:center, inverse

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="50%" align="middle" /&gt;


---

background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/fondo-madera.png)
background-size: cover
class: center, middle

# Tidymodels es un grupo de paquetes centrado en las tareas de modelizaci√≥n de datos. 
# La modelizaci√≥n consta de varios pasos, la idea es que cada paso lo realice una librer√≠a diferente. 


---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

&lt;br&gt;&lt;br&gt;
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidym2.png" width="100%" align="center" /&gt;

--

### Documentaci√≥n
- Tidymodels https://github.com/tidymodels/tidymodels
- Rsample https://tidymodels.github.io/rsample/
- Recipes https://tidymodels.github.io/recipes/reference/index.html
- Parsnip https://tidymodels.github.io/parsnip/
- Yardstick https://tidymodels.github.io/yardstick/ 

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;


# En primer lugar instalamos tidymodels

```r
install.packages(tidymodels)
```


---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;


# Librer√≠as de Tidymodels

```r
library(tidymodels)
```

```
## -- Attaching packages -------------------------------------------- tidymodels 0.0.3 --
```

```
## v broom     0.5.4     v purrr     0.3.3
## v dials     0.0.4     v recipes   0.1.9
## v dplyr     0.8.3     v rsample   0.0.5
## v ggplot2   3.2.1     v tibble    2.1.3
## v infer     0.5.1     v yardstick 0.0.5
## v parsnip   0.0.5
```

```
## -- Conflicts ----------------------------------------------- tidymodels_conflicts() --
## x purrr::discard()    masks scales::discard()
## x dplyr::filter()     masks stats::filter()
## x dplyr::lag()        masks stats::lag()
## x ggplot2::margin()   masks dials::margin()
## x recipes::step()     masks stats::step()
## x recipes::yj_trans() masks scales::yj_trans()
```


---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/text-msg.png)
background-size: cover
class: center, middle

# ‚ú® Data Balanceada


---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

# Datos: Iris

* Conjunto de datos muy popular en an√°lisis multivariado

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/iris-species.png" width="100%" align="center" /&gt;


.footnote[[*]
Mas informaci√≥n en https://es.wikipedia.org/wiki/Conjunto_de_datos_flor_iris 
https://archive.ics.uci.edu/ml/datasets/Iris]

---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

# Vemos los primeros 5 casos del set de datos 

```r
head(iris)
```

```
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa
```

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

# Estad√≠stica descriptiva del set de datos

```r
summary(iris)
```

```
##   Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   
##  Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  
##  1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  
##  Median :5.800   Median :3.000   Median :4.350   Median :1.300  
##  Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  
##  3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  
##  Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  
##        Species  
##  setosa    :50  
##  versicolor:50  
##  virginica :50  
##                 
##                 
## 
```

---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

## Tenemos 150 casos o individuos (filas), 4 columnas o caracter√≠sticas (features) y 1 variable predictora (species)

```r
str(iris)
```

```
## 'data.frame':	150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels "setosa","versicolor",..: 1 1 1 1 1 1 1 1 1 1 ...
```

---
class: inverse, center

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/rsample.png" width="50%" align="center" /&gt;

# `Divisi√≥n de datos`

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/rsample.png" width="10%" align="right" /&gt;

# Entrenamiento / Prueba


&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/training-testing.png" width="75%" align="center" /&gt;


---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/rsample.png" width="10%" align="right" /&gt;

# 1¬∞ Paso: Dividir los datos

### Crear un set de datos training / testing con la librer√≠a *rsamples*



```r
iris_split &lt;- iris %&gt;% #creo un objeto a partir de iris
  `initial_split`(prop = 0.6) #60% de los datos
iris_split 
```

```
## &lt;90/60/150&gt;
```


Estos son los datos de entrenamiento/prueba/total 


---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/engine3.png)
background-size: cover
class: center, middle

# `initial_split()`: nos permite dividir el set de datos en entrenamiento y prueba


---

class: inverse, center

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/recipes.png" width="60%" align="center" /&gt;

# `Preprocesamiento`

---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/recipes_allison.png" width="100%" align="center" /&gt;


---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/recipes.png" width="10%" align="right" /&gt;

# Preprocesamiento

Dentro de esta etapa se incluyen tareas como:
### Centrado
### Escalado
### Remover variables que presenten alta correlaci√≥n

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/recipes.png" width="10%" align="right" /&gt;

# Centrado y Escalado

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/recipes.png" width="10%" align="right" /&gt;

# Remover variables que presenten alta correlaci√≥n




---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/recipes.png" width="10%" align="right" /&gt;

# 2¬∞ Paso: Preprocesamiento

- **recipe()**: empieza una lista de transformaciones a ser aplicadas
&lt;br&gt;
- **step_corr()**: remueve todas las variables con alta correlaci√≥n
- **step_center()**: centrar los datos con media igual a 0. 
- **step_scale()**: Normaliza con desv√≠o est√°ndar igual a 1. 
&lt;br&gt;
- **all_predictors()** y **all_outcomes()** son todas las variables predictivas y predictoras
- **prep()**: Indica que hay que ejecutar todos los pasos anteriores. 


```r
iris_recipe &lt;- `training`(iris_split) %&gt;%
  `recipe`(Species~.) %&gt;%
  `step_corr`(all_predictors()) %&gt;%
  `step_center`(all_predictors(), -all_outcomes()) %&gt;%
  `step_scale`(all_predictors(), -all_outcomes()) %&gt;%
  `prep`()
```


---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/recipes.png" width="10%" align="right" /&gt;


```r
iris_recipe &lt;- training(iris_split) %&gt;%
  recipe(Species~.) %&gt;%
  step_corr(all_predictors()) %&gt;%
  step_center(all_predictors(), -all_outcomes()) %&gt;%
  step_scale(all_predictors(), -all_outcomes()) %&gt;%
  prep()
```


```r
iris_recipe
```

```
## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor          4
## 
## Training data contained 90 data points and no missing data.
## 
## Operations:
## 
## Correlation filter removed Petal.Length [trained]
## Centering for Sepal.Length, Sepal.Width, Petal.Width [trained]
## Scaling for Sepal.Length, Sepal.Width, Petal.Width [trained]
```

---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/engine3.png)
background-size: cover
class: center, middle

# `recipe()`: especifico f√≥rmula
# `step_corr()`: remuevo las variables correlacionadas
# `step_center()`: centrar 
# `step_scale()`: escalar
# `prep()`:


---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/recipes.png" width="10%" align="right" /&gt;

# Orden de las operaciones

1. Imputaci√≥n de valores perdidos.
1. Transformaciones para variables individuales
1. Discretizar las variables (si no hubiera otra opci√≥n)
1. Creaci√≥n de variables latentes
1. Creaci√≥n de interacciones
1. Normalizaci√≥n (centrado, escalado, etc)
1. Transformaciones multivariadas (PCA, etc)



.footnote[Mas informaci√≥n en https://tidymodels.github.io/recipes/articles/Ordering.html]
---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/recipes.png" width="10%" align="right" /&gt;

## juice()
- **juice()** se utiliza para darle formato final al dataset antes del procesamiento de los datos

#### juice() aplicamos a los datos de entrenamiento

```r
iris_training &lt;- `juice`(iris_recipe)
```


```r
head(iris_training)
```

```
## # A tibble: 6 x 4
##   Sepal.Length Sepal.Width Petal.Width Species
##          &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
## 1       -1.15      -0.0966       -1.29 setosa 
## 2       -1.41       0.338        -1.29 setosa 
## 3       -1.02       0.773        -1.29 setosa 
## 4       -1.79      -0.314        -1.29 setosa 
## 5       -1.15       0.121        -1.42 setosa 
## 6       -0.513      1.43         -1.29 setosa
```

.footnote[https://tidymodels.github.io/recipes/reference/juice.html
]

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/recipes.png" width="10%" align="right" /&gt;

## bake()
- **bake()** toma un recipiente entreanado y aplica las operaciones a un set de datos para crear la matriz de dise√±o. 

#### bake() aplicamos a los datos de prueba

```r
iris_testing &lt;- iris_recipe %&gt;%
  `bake`(testing(iris_split)) 
```


```r
iris_testing
```

```
## # A tibble: 60 x 4
##    Sepal.Length Sepal.Width Petal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
##  1       -0.897      0.991        -1.29 setosa 
##  2       -1.54       0.121        -1.29 setosa 
##  3       -1.02       1.21         -1.29 setosa 
##  4       -0.513      1.86         -1.02 setosa 
##  5       -1.54       0.773        -1.16 setosa 
##  6       -1.28      -0.0966       -1.42 setosa 
##  7       -1.92      -0.0966       -1.42 setosa 
##  8       -0.897      0.991        -1.16 setosa 
##  9       -0.513      0.773        -1.29 setosa 
## 10       -0.897      1.43         -1.02 setosa 
## # ... with 50 more rows
```


---

background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/engine3.png)
background-size: cover
class: center, middle


# `juice()`: formato final a datos de entrenamiento
# `bake()`: aplicar transformaciones a datos de prueba


---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

# NO OLVIDAR 

## Para buscar informaci√≥n sobre alguna funci√≥n en particular


```r
library(tidymodels)
`?initial_split`
`?recipe`
`?bake`
```


---

background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/textura-fondo.png)
background-size: cover
class: center, middle, inverse


# üîß DEMO üíª


---
class: inverse, center

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip_h.png" width="70%" align="center" /&gt;

# `Modelizaci√≥n`


---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip_allison.png" width="100%" align="center" /&gt;


---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip.png" width="15%" align="right" /&gt;

# √Årboles de decisi√≥n (Decision Trees)



---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip.png" width="15%" align="right" /&gt;

# Bosques aleatorios (Random Forest)

* Random Forest usa como algoritmo base los √°rboles de decisi√≥n

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/random-forest.png" width="65%" align="center" /&gt;

.footnote[[*]
Imagen tomada de _Python Machine Learning_ (2015) Sebastian Raschka ]

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip.png" width="15%" align="right" /&gt;

# Evaluaci√≥n de un clasificador 

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/eval-clasificador.png" width="100%" align="right" /&gt;



---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip.png" width="15%" align="right" /&gt;

# Matriz de Confusi√≥n

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/matriz-confusion.png" width="100%" align="right" /&gt;



---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip.png" width="15%" align="right" /&gt;

## 3¬∞ Paso: Entrenamiento del modelo

- Para a entrenar un modelo de random forest con librer√≠a {ranger} y {randomForest} en el set de entrenamiento. 
- Se puede entrenar cualquier modelo de clasificaci√≥n o regresi√≥n
- Partes:
1. Crear la especificaci√≥n (create specification)
1. Establecer el motor (set engine)
1. Ajuste (fit)


```r
iris_ranger &lt;- `rand_forest`(trees = 100, mode = "classification") %&gt;%
  `set_engine`("ranger") %&gt;%
  `fit`(Species~., data = iris_training)

iris_ranger
```


.footnote[M√°s informaci√≥n en 
https://tidymodels.github.io/parsnip/articles/articles/Models.html]
---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip.png" width="15%" align="right" /&gt;
{ranger}

```
## parsnip model object
## 
## Fit time:  30ms 
## Ranger result
## 
## Call:
##  ranger::ranger(formula = formula, data = data, num.trees = ~500,      num.threads = 1, verbose = FALSE, seed = sample.int(10^5,          1), probability = TRUE) 
## 
## Type:                             Probability estimation 
## Number of trees:                  500 
## Sample size:                      90 
## Number of independent variables:  3 
## Mtry:                             1 
## Target node size:                 10 
## Variable importance mode:         none 
## Splitrule:                        gini 
## OOB prediction error (Brier s.):  0.05953806
```


---

background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/engine3.png)
background-size: cover
class: center, middle

# `rand_forest()`: declaro `trees` y el `mode` (clasificaci√≥n)
# `set_engine()`: declaro que librer√≠a voy a usar
# `fit()`:declaro la f√≥rmula y los datos de entrada


---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip.png" width="15%" align="right" /&gt;

# `predict()`

```r
predict(objeto, datos_nuevos)
```


* El objeto es un objeto de clase "model fit" (obtenido en el paso anterior)
* datos_nuevos es un tibble o data.frame


.footnote[https://tidymodels.github.io/parsnip/reference/predict.model_fit.html]
---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip.png" width="15%" align="right" /&gt;


```r
predict(iris_ranger, iris_testing)
```

```
## # A tibble: 60 x 1
##    .pred_class
##    &lt;fct&gt;      
##  1 setosa     
##  2 setosa     
##  3 setosa     
##  4 setosa     
##  5 setosa     
##  6 setosa     
##  7 setosa     
##  8 setosa     
##  9 setosa     
## 10 setosa     
## # ... with 50 more rows
```


.footnote[https://tidymodels.github.io/parsnip/reference/predict.model_fit.html]
---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/parsnip.png" width="15%" align="right" /&gt;

# Usando `bind_cols()`puedo observar los datos de prueba y comparar


```r
iris_ranger %&gt;%
  `predict`(iris_testing) %&gt;%
  `bind_cols`(iris_testing) 
```

```
## # A tibble: 60 x 5
##    .pred_class Sepal.Length Sepal.Width Petal.Width Species
##    &lt;fct&gt;              &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
##  1 setosa            -0.897      0.991        -1.29 setosa 
##  2 setosa            -1.54       0.121        -1.29 setosa 
##  3 setosa            -1.02       1.21         -1.29 setosa 
##  4 setosa            -0.513      1.86         -1.02 setosa 
##  5 setosa            -1.54       0.773        -1.16 setosa 
##  6 setosa            -1.28      -0.0966       -1.42 setosa 
##  7 setosa            -1.92      -0.0966       -1.42 setosa 
##  8 setosa            -0.897      0.991        -1.16 setosa 
##  9 setosa            -0.513      0.773        -1.29 setosa 
## 10 setosa            -0.897      1.43         -1.02 setosa 
## # ... with 50 more rows
```


.footnote[https://dplyr.tidyverse.org/reference/bind.html]


---
class: inverse, center

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/yardstick.png" width="60%" align="center" /&gt;

# `Validaci√≥n`

---

background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/fondo-madera.png)
background-size: cover
class: center, middle

# Durante la validaci√≥n, evaluamos el modelo predictivo
# Esa evaluaci√≥n puede ser mediante una m√©trica o un gr√°fico

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/yardstick.jpg" width="10%" align="right" /&gt;

## 4¬∞ Paso: Validaci√≥n del modelo predictivo

### Random Forest con librer√≠a `ranger`

```r
iris_ranger %&gt;%
  predict(iris_testing) %&gt;% #predicci√≥n
  bind_cols(iris_testing) %&gt;% #comparar 
  `metrics`(truth=Species, estimate=.pred_class) #m√©tricas
```

```
## # A tibble: 2 x 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy multiclass     0.95 
## 2 kap      multiclass     0.924
```

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/yardstick.jpg" width="10%" align="right" /&gt;

# `predict()`

```r
iris_ranger %&gt;%
  `predict`(iris_testing)
```

```
## # A tibble: 60 x 1
##    .pred_class
##    &lt;fct&gt;      
##  1 setosa     
##  2 setosa     
##  3 setosa     
##  4 setosa     
##  5 setosa     
##  6 setosa     
##  7 setosa     
##  8 setosa     
##  9 setosa     
## 10 setosa     
## # ... with 50 more rows
```

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/yardstick.jpg" width="10%" align="right" /&gt; 

# `bind_cols()`

```r
iris_ranger %&gt;%
  `predict`(iris_testing) %&gt;%
  `bind_cols`(iris_testing)
```

```
## # A tibble: 60 x 5
##    .pred_class Sepal.Length Sepal.Width Petal.Width Species
##    &lt;fct&gt;              &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
##  1 setosa            -0.897      0.991        -1.29 setosa 
##  2 setosa            -1.54       0.121        -1.29 setosa 
##  3 setosa            -1.02       1.21         -1.29 setosa 
##  4 setosa            -0.513      1.86         -1.02 setosa 
##  5 setosa            -1.54       0.773        -1.16 setosa 
##  6 setosa            -1.28      -0.0966       -1.42 setosa 
##  7 setosa            -1.92      -0.0966       -1.42 setosa 
##  8 setosa            -0.897      0.991        -1.16 setosa 
##  9 setosa            -0.513      0.773        -1.29 setosa 
## 10 setosa            -0.897      1.43         -1.02 setosa 
## # ... with 50 more rows
```


---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/yardstick.jpg" width="10%" align="right" /&gt; 

# `metrics()`

```r
iris_ranger %&gt;%
  `predict`(iris_testing) %&gt;%
  `bind_cols`(iris_testing) %&gt;%
  `metrics`(truth=Species, estimate=.pred_class)
```

```
## # A tibble: 2 x 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy multiclass     0.95 
## 2 kap      multiclass     0.924
```


---

# `sens()`

```r
iris_ranger %&gt;%
  predict(iris_testing) %&gt;%
  bind_cols(iris_testing) %&gt;%
  `sens`(truth=Species, estimate=.pred_class) #sensibilidad
```

```
## # A tibble: 1 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 sens    macro          0.953
```

---
# `spec()`


```r
iris_ranger %&gt;%
  predict(iris_testing) %&gt;%
  bind_cols(iris_testing) %&gt;%
  `spec`(truth=Species, estimate=.pred_class) #especificidad
```

```
## # A tibble: 1 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 spec    macro          0.975
```

---
# `precision()`

```r
iris_ranger %&gt;%
  predict(iris_testing) %&gt;%
  bind_cols(iris_testing) %&gt;%
  `precision`(truth=Species, estimate=.pred_class) #precisi√≥n
```

```
## # A tibble: 1 x 3
##   .metric   .estimator .estimate
##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
## 1 precision macro          0.948
```

---
# `conf_mat()`


```r
iris_ranger %&gt;%
  predict(iris_testing) %&gt;%
  bind_cols(iris_testing) %&gt;%
  `conf_mat`(truth=Species, estimate=.pred_class) #matriz de confusi√≥n
```

```
##             Truth
## Prediction   setosa versicolor virginica
##   setosa         19          0         0
##   versicolor      0         16         2
##   virginica       0          1        22
```
---
background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/engine3.png)
background-size: cover
class: center, middle

# `metrics()`: exactitud y kappa
# `sens()`: sensibilidad
# `spec()`: especificidad
# `precision()`: precisi√≥n
# `conf_mat()`: matriz de confusi√≥n



---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/yardstick.jpg" width="10%" align="right" /&gt;


```r
iris_ranger %&gt;%
  predict(iris_testing, type="prob")
```

```
## # A tibble: 60 x 3
##    .pred_setosa .pred_versicolor .pred_virginica
##           &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
##  1        0.998         0.000622        0.00146 
##  2        0.969         0.0193          0.0118  
##  3        0.981         0.00598         0.0131  
##  4        0.992         0.00618         0.00224 
##  5        0.989         0.00272         0.00870 
##  6        0.968         0.0198          0.0125  
##  7        0.968         0.0198          0.0125  
##  8        0.998         0.000622        0.00146 
##  9        0.958         0.0316          0.0102  
## 10        0.999         0.000622        0.000222
## # ... with 50 more rows
```
---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/yardstick.jpg" width="10%" align="right" /&gt;

# Obtengo las probabilidades



```r
iris_probs &lt;- iris_ranger %&gt;%
  `predict`(iris_testing, type = "prob") %&gt;%
  bind_cols(iris_testing)%&gt;%
  select(.pred_setosa:.pred_virginica, Species)
iris_probs
```

```
## # A tibble: 60 x 4
##    .pred_setosa .pred_versicolor .pred_virginica Species
##           &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt; &lt;fct&gt;  
##  1        0.998         0.000622        0.00146  setosa 
##  2        0.969         0.0193          0.0118   setosa 
##  3        0.981         0.00598         0.0131   setosa 
##  4        0.992         0.00618         0.00224  setosa 
##  5        0.989         0.00272         0.00870  setosa 
##  6        0.968         0.0198          0.0125   setosa 
##  7        0.968         0.0198          0.0125   setosa 
##  8        0.998         0.000622        0.00146  setosa 
##  9        0.958         0.0316          0.0102   setosa 
## 10        0.999         0.000622        0.000222 setosa 
## # ... with 50 more rows
```

---


---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/yardstick.jpg" width="10%" align="right" /&gt;

# Curvas ROC

* Las curvas ROC son una poderosa herramienta gr√°fica para visualizar el desempe√±o de un algoritmo de aprendizaje a trav√©s de una variaci√≥n en el criterio de decisi√≥n. 
&lt;br&gt;&lt;br&gt;
* Las curvas ROC se han utilizado no s√≥lo para __estudiar el comportamiento de un algoritmo__ sino tambi√©n __identificar regiones √≥ptimas de desempe√±o__, __realizar la selecci√≥n de modelos__, y lo m√°s importante para __comparar y evaluar algoritmos de aprendizaje autom√°tico__. 
&lt;br&gt;&lt;br&gt;
* En el _eje X_ de una curva ROC tenemos el eje horizontal, que muestra la _tasa de falsos positivos (TFP)_ y el eje vertical (_eje y_) muestra la _tasa de verdaderos positivos_ de un clasificador. 

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/yardstick.jpg" width="10%" align="right" /&gt;


```r
iris_probs%&gt;%
  `roc_curve`(.pred_setosa:.pred_virginica, truth=Species) %&gt;%
  `autoplot`()
```

![](ml-fundamentals_files/figure-html/unnamed-chunk-32-1.png)&lt;!-- --&gt;


---

background-image: url(C:/Users/Roxana/curso-r-analisis-datos/img/engine3.png)
background-size: cover
class: center, middle

# `roc_curve()`: curva ROC
# `autoplot()`: me permite graficar
---

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/yardstick.jpg" width="10%" align="right" /&gt;



```r
predict(iris_ranger, iris_testing, type = "prob") %&gt;%
  bind_cols(predict(iris_ranger, iris_testing)) %&gt;%
  bind_cols(select(iris_testing, Species)) %&gt;%
  metrics(Species, .pred_setosa:.pred_virginica, estimate = .pred_class)
```

```
## # A tibble: 4 x 3
##   .metric     .estimator .estimate
##   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy    multiclass     0.95 
## 2 kap         multiclass     0.924
## 3 mn_log_loss multiclass     0.196
## 4 roc_auc     hand_till      0.990
```

---
&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/tidymodels.png" width="10%" align="right" /&gt;

# Resumiendo

&lt;img src="C://Users/Roxana/curso-r-analisis-datos/img/resumen-tidymodels.png" width="100%" align="right" /&gt;



---
# Bibliograf√≠a

- Tutorial de Tidymodels
https://rviews.rstudio.com/2019/06/19/a-gentle-intro-to-tidymodels/
- Tutorial de Tidymodels (espa√±ol)
https://diegokoz.github.io/EEA2019/clase%208/tidymodels.nb.html
- Tutorial "Modeling with parsnip and tidymodels"
https://www.benjaminsorensen.me/post/modeling-with-parsnip-and-tidymodels/
- parsnip: A tidy model interface - Max Kuhn (video)
bit.ly/parsnip-rstudioconf2019 
- Recipes for data Preprocessing - Max Kuhn (video)
bit.ly/recipes-useR2018



---


```r
sessionInfo() 
```

```
## R version 3.6.2 (2019-12-12)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 18362)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=Spanish_Argentina.1252  LC_CTYPE=Spanish_Argentina.1252   
## [3] LC_MONETARY=Spanish_Argentina.1252 LC_NUMERIC=C                      
## [5] LC_TIME=Spanish_Argentina.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] yardstick_0.0.5   tibble_2.1.3      rsample_0.0.5     tidyr_1.0.2      
##  [5] recipes_0.1.9     purrr_0.3.3       parsnip_0.0.5     infer_0.5.1      
##  [9] ggplot2_3.2.1     dplyr_0.8.3       dials_0.0.4       scales_1.1.0     
## [13] broom_0.5.4       tidymodels_0.0.3  emo_0.0.0.9000    fontawesome_0.1.0
## 
## loaded via a namespace (and not attached):
##   [1] minqa_1.2.4          colorspace_1.4-1     class_7.3-15        
##   [4] ggridges_0.5.2       rsconnect_0.8.16     markdown_1.1        
##   [7] base64enc_0.1-3      tidytext_0.2.2       rstudioapi_0.11     
##  [10] farver_2.0.3         listenv_0.8.0        furrr_0.1.0         
##  [13] xaringan_0.14        rstan_2.19.2         SnowballC_0.6.0     
##  [16] DT_0.12              prodlim_2019.11.13   fansi_0.4.1         
##  [19] lubridate_1.7.4      ranger_0.12.1        codetools_0.2-16    
##  [22] splines_3.6.2        knitr_1.28           shinythemes_1.1.2   
##  [25] bayesplot_1.7.1      nloptr_1.2.1         pROC_1.16.1         
##  [28] shiny_1.4.0          compiler_3.6.2       backports_1.1.5     
##  [31] assertthat_0.2.1     Matrix_1.2-18        fastmap_1.0.1       
##  [34] lazyeval_0.2.2       cli_2.0.1            later_1.0.0         
##  [37] htmltools_0.4.0      prettyunits_1.1.1    tools_3.6.2         
##  [40] igraph_1.2.4.2       gtable_0.3.0         glue_1.3.1          
##  [43] reshape2_1.4.3       Rcpp_1.0.3           DiceDesign_1.8-1    
##  [46] vctrs_0.2.2          nlme_3.1-142         crosstalk_1.0.0     
##  [49] timeDate_3043.102    gower_0.2.1          xfun_0.12           
##  [52] stringr_1.4.0        globals_0.12.5       ps_1.3.0            
##  [55] lme4_1.1-21          mime_0.9             miniUI_0.1.1.1      
##  [58] lifecycle_0.1.0      gtools_3.8.1         tidypredict_0.4.3   
##  [61] future_1.16.0        MASS_7.3-51.4        zoo_1.8-7           
##  [64] ipred_0.9-9          rstanarm_2.19.2      colourpicker_1.0    
##  [67] promises_1.1.0       parallel_3.6.2       inline_0.3.15       
##  [70] shinystan_2.5.0      tidyposterior_0.0.2  yaml_2.2.1          
##  [73] gridExtra_2.3        loo_2.2.0            StanHeaders_2.21.0-1
##  [76] rpart_4.1-15         stringi_1.4.5        tokenizers_0.2.1    
##  [79] dygraphs_1.1.1.6     boot_1.3-23          pkgbuild_1.0.6      
##  [82] lava_1.6.6           matrixStats_0.55.0   rlang_0.4.2         
##  [85] pkgconfig_2.0.3      evaluate_0.14        lattice_0.20-38     
##  [88] labeling_0.3         rstantools_2.0.0     htmlwidgets_1.5.1   
##  [91] tidyselect_0.2.5     processx_3.4.1       plyr_1.8.4          
##  [94] magrittr_1.5         R6_2.4.1             generics_0.0.2      
##  [97] pillar_1.4.3         withr_2.1.2          xts_0.12-0          
## [100] survival_3.1-8       nnet_7.3-12          janeaustenr_0.1.5   
## [103] crayon_1.3.4         utf8_1.1.4           rmarkdown_2.1       
## [106] grid_3.6.2           callr_3.4.1          threejs_0.3.3       
## [109] digest_0.6.23        xtable_1.8-4         httpuv_1.5.2        
## [112] stats4_3.6.2         munsell_0.5.0        shinyjs_1.1
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
